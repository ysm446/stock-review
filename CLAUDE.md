# Stock Review â€” è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

Stock Review ã¯ã€yfinance ãƒ™ãƒ¼ã‚¹ã®å‰²å®‰æ ªã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»æŠ•è³‡åˆ†æã‚·ã‚¹ãƒ†ãƒ ã‚’ **Gradio Web ã‚¢ãƒ—ãƒª** ã¨ã—ã¦æä¾›ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚
[okikusan-public/stock_skills](https://github.com/okikusan-public/stock_skills) ã®è¨­è¨ˆæ€æƒ³ã¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’å‚è€ƒã«ã€ãƒ­ãƒ¼ã‚«ãƒ« LLM ã‚’æ´»ç”¨ã—ãŸå¯¾è©±çš„ãªéŠ˜æŸ„åˆ†æã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

### å…ƒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã®é•ã„

| é …ç›® | stock_skills (å…ƒ) | Stock Review (æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ) |
|------|-------------------|-------------------------------|
| ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | Claude Code Skills (CLI/è‡ªç„¶è¨€èª) | Gradio Web UI |
| LLM | Claude Code (API) | ãƒ­ãƒ¼ã‚«ãƒ« LLM (Ollama) |
| LLM ã®å½¹å‰² | ã‚¹ã‚­ãƒ«é¸æŠãƒ»çµæœè§£é‡ˆ | ãƒ¬ãƒãƒ¼ãƒˆè‡ªç„¶è¨€èªåŒ–ãƒ»å¯¾è©±çš„åˆ†æ |
| ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ | yfinance | yfinance (åŒã˜) |
| æ°¸ç¶šåŒ– | CSV/YAML/JSON/CLAUDE.md | CSV/YAML/JSON/SQLite |
| å®Ÿè¡Œç’°å¢ƒ | ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ãƒ¼ãƒŸãƒŠãƒ« | ãƒ–ãƒ©ã‚¦ã‚¶ (localhost) |

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 3å±¤æ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI å±¤ (Gradio)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Screening â”‚ â”‚ Report   â”‚ â”‚Portfolio â”‚ â”‚ Stress  â”‚ â”‚
â”‚  â”‚   Tab    â”‚ â”‚   Tab    â”‚ â”‚   Tab    â”‚ â”‚Test Tab â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚          Chat Tab (å¯¾è©±çš„åˆ†æã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ)          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Core å±¤ (ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯)                            â”‚
â”‚  screener.py â”‚ indicators.py â”‚ alpha.py              â”‚
â”‚  technicals.py â”‚ health_check.py â”‚ return_estimate.pyâ”‚
â”‚  concentration.py â”‚ correlation.py                   â”‚
â”‚  shock_sensitivity.py â”‚ scenario_analysis.py         â”‚
â”‚  recommender.py â”‚ portfolio_manager.py               â”‚
â”‚  report_generator.py                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Data å±¤ (ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»LLM)                 â”‚
â”‚  yahoo_client.py â”‚ llm_client.py â”‚ cache_manager.py  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
stock-advisor/
â”œâ”€â”€ CLAUDE.md                    # æœ¬ãƒ•ã‚¡ã‚¤ãƒ« (è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ app.py                       # Gradio ã‚¢ãƒ—ãƒª ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ presets.yaml             # ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒªã‚»ãƒƒãƒˆå®šç¾©
â”‚   â”œâ”€â”€ exchanges.yaml           # å–å¼•æ‰€ãƒ»åœ°åŸŸå®šç¾©
â”‚   â””â”€â”€ scenarios.yaml           # ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªå®šç¾©
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ core/                    # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ screener.py          # 4ã‚¹ã‚¯ãƒªãƒ¼ãƒŠãƒ¼ (Query/Value/Pullback/Alpha)
â”‚   â”‚   â”œâ”€â”€ indicators.py        # ãƒãƒªãƒ¥ãƒ¼ã‚¹ã‚³ã‚¢ (100ç‚¹æº€ç‚¹)
â”‚   â”‚   â”œâ”€â”€ alpha.py             # å¤‰åŒ–ã‚¹ã‚³ã‚¢ (100ç‚¹æº€ç‚¹)
â”‚   â”‚   â”œâ”€â”€ technicals.py        # ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ãƒ»æŠ¼ã—ç›®åˆ¤å®š
â”‚   â”‚   â”œâ”€â”€ health_check.py      # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ (3æ®µéšã‚¢ãƒ©ãƒ¼ãƒˆ)
â”‚   â”‚   â”œâ”€â”€ return_estimate.py   # æ¨å®šåˆ©å›ã‚Š (3ã‚·ãƒŠãƒªã‚ª)
â”‚   â”‚   â”œâ”€â”€ concentration.py     # HHI é›†ä¸­åº¦åˆ†æ
â”‚   â”‚   â”œâ”€â”€ correlation.py       # ç›¸é–¢åˆ†æãƒ»ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼åˆ†è§£ãƒ»VaR
â”‚   â”‚   â”œâ”€â”€ shock_sensitivity.py # ã‚·ãƒ§ãƒƒã‚¯æ„Ÿå¿œåº¦
â”‚   â”‚   â”œâ”€â”€ scenario_analysis.py # ã‚·ãƒŠãƒªã‚ªåˆ†æ (8ã‚·ãƒŠãƒªã‚ª)
â”‚   â”‚   â”œâ”€â”€ recommender.py       # æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ portfolio_manager.py # ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç®¡ç† (å£²è²·è¨˜éŒ²ãƒ»æç›Š)
â”‚   â”‚   â””â”€â”€ report_generator.py  # å€‹åˆ¥éŠ˜æŸ„ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
â”‚   â”œâ”€â”€ data/                    # ãƒ‡ãƒ¼ã‚¿å–å¾—å±¤
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ yahoo_client.py      # yfinance ãƒ©ãƒƒãƒ‘ãƒ¼ (ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ã‚µãƒ‹ã‚¿ã‚¤ã‚º)
â”‚   â”‚   â”œâ”€â”€ llm_client.py        # ãƒ­ãƒ¼ã‚«ãƒ« LLM ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (Ollama)
â”‚   â”‚   â””â”€â”€ cache_manager.py     # JSON ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (24h TTL)
â”‚   â”œâ”€â”€ ui/                      # Gradio UI å®šç¾©
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ screening_tab.py     # ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã‚¿ãƒ–
â”‚   â”‚   â”œâ”€â”€ report_tab.py        # å€‹åˆ¥éŠ˜æŸ„ãƒ¬ãƒãƒ¼ãƒˆã‚¿ãƒ–
â”‚   â”‚   â”œâ”€â”€ portfolio_tab.py     # ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç®¡ç†ã‚¿ãƒ–
â”‚   â”‚   â”œâ”€â”€ stress_test_tab.py   # ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã‚¿ãƒ–
â”‚   â”‚   â”œâ”€â”€ chat_tab.py          # å¯¾è©±çš„åˆ†æã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚¿ãƒ–
â”‚   â”‚   â””â”€â”€ components.py        # å…±é€š UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ utils/                   # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ formatter.py         # Markdown / ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿
â”‚       â””â”€â”€ validators.py        # å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ data/                        # æ°¸ç¶šãƒ‡ãƒ¼ã‚¿ (gitignore å¯¾è±¡)
â”‚   â”œâ”€â”€ portfolio.csv            # ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªå£²è²·è¨˜éŒ²
â”‚   â”œâ”€â”€ watchlist.json           # ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆ
â”‚   â””â”€â”€ cache/                   # API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥
â”œâ”€â”€ models/                      # Ollama ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ« (gitignore å¯¾è±¡)
â”‚   â””â”€â”€ (qwen3:14b ç­‰ã®ãƒ¢ãƒ‡ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã‚‹)
â””â”€â”€ tests/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ core/                    # Core å±¤ãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ data/                    # Data å±¤ãƒ†ã‚¹ãƒˆ
    â””â”€â”€ conftest.py              # ãƒ†ã‚¹ãƒˆå…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
```

---

## æ©Ÿèƒ½ä»•æ§˜

### 1. å‰²å®‰æ ªã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚° (`src/core/screener.py`)

4ã¤ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ç”¨é€”ã«å¿œã˜ã¦ä½¿ã„åˆ†ã‘ã‚‹ã€‚

| ã‚¨ãƒ³ã‚¸ãƒ³ | ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ | ç”¨é€” |
|----------|-----------|------|
| QueryScreener | yfinance EquityQuery ã§ãƒãƒ«ã‚¯å–å¾— â†’ ãƒãƒªãƒ¥ãƒ¼ã‚¹ã‚³ã‚¢ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚° | åŸºæœ¬çš„ãªå‰²å®‰æ ªæ¤œç´¢ |
| PullbackScreener | EquityQuery â†’ RSI/ãƒœãƒªãƒ³ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ‰ã§æŠ¼ã—ç›®åˆ¤å®š â†’ ãƒãƒªãƒ¥ãƒ¼ã‚¹ã‚³ã‚¢ | ä¸€æ™‚èª¿æ•´ã‚¨ãƒ³ãƒˆãƒªãƒ¼ |
| AlphaScreener | EquityQuery(è¶³åˆ‡ã‚Š) â†’ å¤‰åŒ–ã‚¹ã‚³ã‚¢ â†’ æŠ¼ã—ç›®åˆ¤å®š â†’ 2è»¸ã‚¹ã‚³ã‚¢ | æ¥­ç¸¾æ”¹å–„+å‰²å®‰ (4æ®µãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³) |
| ValueScreener | éŠ˜æŸ„ãƒªã‚¹ãƒˆ1ä»¶ãšã¤å–å¾— â†’ ãƒ•ã‚£ãƒ«ã‚¿ â†’ ã‚¹ã‚³ã‚¢ | å€‹åˆ¥ãƒªã‚¹ãƒˆæŒ‡å®š |

#### 7ã¤ã®ãƒ—ãƒªã‚»ãƒƒãƒˆ

| ãƒ—ãƒªã‚»ãƒƒãƒˆ | èª¬æ˜ | ä¸»ãªæ¡ä»¶ |
|-----------|------|---------|
| value | ãƒãƒªãƒ¥ãƒ¼ (æ¨™æº–) | PER<15, PBR<1.5, é…å½“>2% |
| high-dividend | é«˜é…å½“ | é…å½“åˆ©å›ã‚Šé‡è¦– |
| growth-value | æˆé•·å‰²å®‰ | PEG<1.5, å£²ä¸Šæˆé•·ç‡>10% |
| deep-value | ãƒ‡ã‚£ãƒ¼ãƒ—ãƒãƒªãƒ¥ãƒ¼ | PBR<0.8, ãƒãƒƒãƒˆãƒãƒƒãƒˆå‹ |
| quality | ã‚¯ã‚ªãƒªãƒ†ã‚£ | ROE>15%, å®‰å®šé…å½“ |
| pullback | æŠ¼ã—ç›®è²·ã„ | ä¸Šæ˜‡ãƒˆãƒ¬ãƒ³ãƒ‰ä¸­ã®ä¸€æ™‚èª¿æ•´ |
| alpha | ã‚¢ãƒ«ãƒ•ã‚¡ | å‰²å®‰+æ¥­ç¸¾æ”¹å–„ã®å…†ã— |

#### ãƒãƒªãƒ¥ãƒ¼ã‚¹ã‚³ã‚¢é…åˆ† (100ç‚¹æº€ç‚¹)

```
PER:         25ç‚¹ (ä½ã„ã»ã©é«˜å¾—ç‚¹)
PBR:         25ç‚¹ (ä½ã„ã»ã©é«˜å¾—ç‚¹)
é…å½“åˆ©å›ã‚Š:    20ç‚¹ (é«˜ã„ã»ã©é«˜å¾—ç‚¹)
ROE:         15ç‚¹ (é«˜ã„ã»ã©é«˜å¾—ç‚¹)
å£²ä¸Šæˆé•·ç‡:    15ç‚¹ (é«˜ã„ã»ã©é«˜å¾—ç‚¹)
```

#### å¤‰åŒ–ã‚¹ã‚³ã‚¢ (Alphaç”¨, 100ç‚¹æº€ç‚¹)

4æŒ‡æ¨™ã§ã€Œæ¥­ç¸¾ãŒè‰¯ã„æ–¹å‘ã«å¤‰åŒ–ã—ã¦ã„ã‚‹ã‹ã€ã‚’å®šé‡åŒ–:

- ã‚¢ã‚¯ãƒ«ãƒ¼ã‚¢ãƒ«ã‚º (åˆ©ç›Šã®è³ª)
- å£²ä¸ŠåŠ é€Ÿåº¦
- FCF ãƒãƒ¼ã‚¸ãƒ³å¤‰åŒ–
- ROE è¶¨å‹¢

#### å¯¾å¿œåœ°åŸŸ

yfinance EquityQuery ã® 60+ å–å¼•æ‰€ã«å¯¾å¿œã€‚ä¸»è¦ãªåœ°åŸŸ:

- japan: æ±è¨¼ (ãƒ—ãƒ©ã‚¤ãƒ ãƒ»ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ»ã‚°ãƒ­ãƒ¼ã‚¹)
- us: NYSE, NASDAQ
- asean: SGX, SET, BURSA, IDX, PSE
- hongkong: HKEX
- europe: LSE, FRA, PAR, AMS
- ãã®ä»–: config/exchanges.yaml ã§å®šç¾©

#### Gradio UI è¨­è¨ˆ

- åœ°åŸŸé¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³
- ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³
- ã‚»ã‚¯ã‚¿ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
- çµæœãƒ†ãƒ¼ãƒ–ãƒ« (ã‚½ãƒ¼ãƒˆå¯èƒ½, ã‚¹ã‚³ã‚¢ãƒ»PERãƒ»PBRãƒ»é…å½“åˆ©å›ã‚Šç­‰ã®ã‚«ãƒ©ãƒ )
- ã€Œãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã§å€‹åˆ¥éŠ˜æŸ„ã‚¿ãƒ–ã¸é·ç§»

### 2. å€‹åˆ¥éŠ˜æŸ„ãƒ¬ãƒãƒ¼ãƒˆ (`src/core/report_generator.py`)

ãƒ†ã‚£ãƒƒã‚«ãƒ¼æŒ‡å®šã§è²¡å‹™åˆ†æãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã€‚

#### ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹

- åŸºæœ¬æƒ…å ±: ç¤¾å, ã‚»ã‚¯ã‚¿ãƒ¼, æ™‚ä¾¡ç·é¡, 52é€±ãƒ¬ãƒ³ã‚¸
- ãƒãƒªãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³: PER, PBR, EV/EBITDA, é…å½“åˆ©å›ã‚Š
- è²¡å‹™ã‚µãƒãƒªãƒ¼: å£²ä¸Šé«˜, å–¶æ¥­åˆ©ç›Š, ç´”åˆ©ç›Š (3æœŸåˆ†)
- åç›Šæ€§: ROE, ROA, å–¶æ¥­åˆ©ç›Šç‡, FCFãƒãƒ¼ã‚¸ãƒ³
- ã‚¢ãƒŠãƒªã‚¹ãƒˆã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹: ç›®æ¨™æ ªä¾¡ (High/Mean/Low), ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°, ã‚¢ãƒŠãƒªã‚¹ãƒˆæ•°
- ãƒãƒªãƒ¥ãƒ¼ã‚¹ã‚³ã‚¢ (100ç‚¹) + åˆ¤å®š
- æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ (yfinance ã‹ã‚‰å–å¾—)

#### ãƒ­ãƒ¼ã‚«ãƒ« LLM æ´»ç”¨

ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ« LLM ã«æ¸¡ã—ã€ä»¥ä¸‹ã‚’è‡ªç„¶è¨€èªã§ç”Ÿæˆ:

- æŠ•è³‡åˆ¤æ–­ã‚µãƒãƒªãƒ¼ (3-5è¡Œã®ç·åˆè©•ä¾¡)
- ãƒªã‚¹ã‚¯è¦å› ã®è§£èª¬
- æ³¨ç›®ãƒã‚¤ãƒ³ãƒˆ

### 3. ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç®¡ç† (`src/core/portfolio_manager.py`)

#### ã‚µãƒ–æ©Ÿèƒ½

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| å£²è²·è¨˜éŒ² | buy/sell ã®è¨˜éŒ² (ãƒ†ã‚£ãƒƒã‚«ãƒ¼, æ•°é‡, å˜ä¾¡, é€šè²¨) |
| ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ | ç¾åœ¨ã®è©•ä¾¡é¡ãƒ»æç›Šä¸€è¦§ (å¤šé€šè²¨â†’JPYæ›ç®—) |
| æ§‹é€ åˆ†æ | HHIé›†ä¸­åº¦, ã‚»ã‚¯ã‚¿ãƒ¼é…åˆ†, åœ°åŸŸé…åˆ† |
| ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ | 3æ®µéšã‚¢ãƒ©ãƒ¼ãƒˆã§æŠ•è³‡ä»®èª¬ã®æœ‰åŠ¹æ€§ã‚’åˆ¤å®š |
| æ¨å®šåˆ©å›ã‚Š | æ¥½è¦³/ãƒ™ãƒ¼ã‚¹/æ‚²è¦³ã®3ã‚·ãƒŠãƒªã‚ª |
| ãƒªãƒãƒ©ãƒ³ã‚¹ææ¡ˆ | é›†ä¸­åº¦ã«åŸºã¥ãèª¿æ•´ææ¡ˆ |

#### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯: 3æ®µéšã‚¢ãƒ©ãƒ¼ãƒˆ

| ãƒ¬ãƒ™ãƒ« | ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æ¡ä»¶ | ãƒ•ã‚¡ãƒ³ãƒ€ãƒ¡ãƒ³ã‚¿ãƒ«æ¡ä»¶ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|--------|-------------|-------------------|-----------|
| æ—©æœŸè­¦å‘Š | SMA50å‰²ã‚Œ / RSIæ€¥è½ | â€” | æ³¨è¦– |
| æ³¨æ„ | SMA50ãŒSMA200ã«æ¥è¿‘ | å¤‰åŒ–ã‚¹ã‚³ã‚¢1æŒ‡æ¨™æ‚ªåŒ– | ä¸€éƒ¨åˆ©ç¢ºæ¤œè¨ |
| æ’¤é€€ | ãƒ‡ãƒƒãƒ‰ã‚¯ãƒ­ã‚¹ | å¤‰åŒ–ã‚¹ã‚³ã‚¢è¤‡æ•°æ‚ªåŒ– | æ’¤é€€æ¤œè¨ |

**é‡è¦ãªè¨­è¨ˆåˆ¤æ–­:**
- æ’¤é€€ã‚·ã‚°ãƒŠãƒ«ã«ã¯ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«å´©å£Šã¨ãƒ•ã‚¡ãƒ³ãƒ€æ‚ªåŒ–ã® **ä¸¡æ–¹** ã‚’è¦æ±‚
- ETF ã¯è³‡ç”£ã‚¯ãƒ©ã‚¹ã§è‡ªå‹•åˆ†é¡ã—ã€ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã®ã¿ã§è©•ä¾¡ (ãƒ•ã‚¡ãƒ³ãƒ€åˆ†æå¯¾è±¡å¤–)
- ETF åˆ¤å®š: `quoteType == "ETF"` ã«åŠ ãˆã€å£²ä¸Šå±¥æ­´ãŒç©ºãƒªã‚¹ãƒˆ/None ã®å ´åˆã‚‚ ETF æ‰±ã„ (`bool()` ã§ truthiness ãƒã‚§ãƒƒã‚¯)

#### æ¨å®šåˆ©å›ã‚Š: 3ã‚·ãƒŠãƒªã‚ª

**å€‹åˆ¥æ ª:** ã‚¢ãƒŠãƒªã‚¹ãƒˆç›®æ¨™æ ªä¾¡ (High/Mean/Low) ãƒ™ãƒ¼ã‚¹
- ã‚¢ãƒŠãƒªã‚¹ãƒˆ3åæœªæº€ã®å ´åˆã€è‡ªå‹•ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ‹¡å¼µ

**ETF:** éå»2å¹´æœˆæ¬¡ãƒªã‚¿ãƒ¼ãƒ³ã® CAGR ãƒ™ãƒ¼ã‚¹
- æ¨™æº–åå·®ã§ã‚·ãƒŠãƒªã‚ªåˆ†å²
- ã‚­ãƒ£ãƒƒãƒ—ä»˜ãã§ç•°å¸¸å€¤ã«ã‚ˆã‚‹éå¤§è©•ä¾¡ã‚’é˜²æ­¢
- å˜åˆ©(12å€)ã§ã¯ãªã CAGR (è¤‡åˆ©å¹´ç‡) ã‚’ä½¿ç”¨

#### ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–

```
data/portfolio.csv:
  date,action,ticker,quantity,price,currency,notes
  2025-01-15,buy,7203.T,100,2850,JPY,æ±ºç®—å¾Œã®æŠ¼ã—ç›®
  2025-02-01,sell,AAPL,5,185.50,USD,åˆ©ç¢º
```

### 4. ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ (`src/core/scenario_analysis.py` ä»–)

#### åˆ†æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```
é›†ä¸­åº¦åˆ†æ (HHI)
  â†’ ã‚·ãƒ§ãƒƒã‚¯æ„Ÿå¿œåº¦
    â†’ ã‚·ãƒŠãƒªã‚ªåˆ¥ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆæ¨å®š
      â†’ ç›¸é–¢åˆ†æ (ãƒ”ã‚¢ã‚½ãƒ³ç›¸é–¢ + ãƒã‚¯ãƒ­å› å­åˆ†è§£)
        â†’ VaR (95% / 99%)
          â†’ å› æœé€£é–åˆ†æ
            â†’ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
```

#### 8ã¤ã®äº‹å‰å®šç¾©ã‚·ãƒŠãƒªã‚ª

| ã‚·ãƒŠãƒªã‚ª | å†…å®¹ |
|---------|------|
| ãƒˆãƒªãƒ—ãƒ«å®‰ | æ ªå®‰ãƒ»å††å®‰ãƒ»å‚µåˆ¸å®‰ã®åŒæ™‚ç™ºç”Ÿ |
| ãƒ†ãƒƒã‚¯æš´è½ | ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã‚»ã‚¯ã‚¿ãƒ¼æ€¥è½ |
| å††é«˜ãƒ‰ãƒ«å®‰ | æ€¥æ¿€ãªå††é«˜é€²è¡Œ |
| é‡‘åˆ©æ€¥é¨° | é•·æœŸé‡‘åˆ©ã®æ€¥ä¸Šæ˜‡ |
| ãƒªã‚»ãƒƒã‚·ãƒ§ãƒ³ | æ™¯æ°—å¾Œé€€ã‚·ãƒŠãƒªã‚ª |
| åœ°æ”¿å­¦ãƒªã‚¹ã‚¯ | å›½éš›çš„ãªæ”¿æ²»ãƒªã‚¹ã‚¯ |
| ã‚¤ãƒ³ãƒ•ãƒ¬åŠ é€Ÿ | äºˆæƒ³ä»¥ä¸Šã®ã‚¤ãƒ³ãƒ•ãƒ¬ |
| ãƒ‘ãƒ³ãƒ‡ãƒŸãƒƒã‚¯ | æ„ŸæŸ“ç—‡ãƒ‘ãƒ³ãƒ‡ãƒŸãƒƒã‚¯ |

#### ETF ã®æ‰±ã„

- è³‡ç”£ã‚¯ãƒ©ã‚¹è‡ªå‹•åˆ†é¡: é‡‘ETF, é•·æœŸå‚µETF, æ ªå¼ã‚¤ãƒ³ã‚«ãƒ ETF ç­‰
- ã‚·ãƒŠãƒªã‚ªã”ã¨ã«é©åˆ‡ãªã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆä¿‚æ•°ã‚’é©ç”¨
- ä¾‹: ãƒˆãƒªãƒ—ãƒ«å®‰ã§é‡‘ETF ã¯ãƒ˜ãƒƒã‚¸æ©Ÿèƒ½ (é€†æ–¹å‘ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ)

### 5. å¯¾è©±çš„åˆ†æã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ (`src/ui/chat_tab.py`)

ãƒ­ãƒ¼ã‚«ãƒ« LLM ã‚’æ´»ç”¨ã—ãŸå¯¾è©±å‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€‚

#### æ©Ÿèƒ½

- è‡ªç„¶è¨€èªã§ã®éŠ˜æŸ„è³ªå• (ä¾‹: ã€Œãƒˆãƒ¨ã‚¿ã®æœ€è¿‘ã®æ¥­ç¸¾ã¯ã©ã†ï¼Ÿã€)
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°çµæœã®æ·±æ˜ã‚Š (ä¾‹: ã€Œã“ã®éŠ˜æŸ„ãŒãƒ©ãƒ³ã‚¯ã‚¤ãƒ³ã—ãŸç†ç”±ã¯ï¼Ÿã€)
- ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç›¸è«‡ (ä¾‹: ã€Œä»Šã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®ãƒªã‚¹ã‚¯ã¯ï¼Ÿã€)
- æ¯”è¼ƒåˆ†æ (ä¾‹: ã€Œãƒˆãƒ¨ã‚¿ã¨ãƒ›ãƒ³ãƒ€ã‚’æ¯”è¼ƒã—ã¦ã€)

#### å®Ÿè£…æ–¹é‡

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚’å—ã‘å–ã‚Šã€å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’ yfinance ã‹ã‚‰å–å¾—
- å–å¾—ãƒ‡ãƒ¼ã‚¿ + è³ªå•ã‚’ãƒ­ãƒ¼ã‚«ãƒ« LLM ã«æ¸¡ã—ã¦å›ç­”ã‚’ç”Ÿæˆ
- ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ä¿æŒã—ã€æ–‡è„ˆã‚’ç¶­æŒ
- å®šé‡ãƒ‡ãƒ¼ã‚¿ (è¨ˆç®—çµæœ) ã¨å®šæ€§åˆ†æ (LLM ã®è§£é‡ˆ) ã‚’åˆ†é›¢

---

## Data å±¤ ä»•æ§˜

### yahoo_client.py â€” yfinance ãƒ©ãƒƒãƒ‘ãƒ¼

å¤–éƒ¨ API ã‚’ç›´æ¥å‘¼ã°ãšã€å¿…ãšã“ã®ãƒ©ãƒƒãƒ‘ãƒ¼çµŒç”±ã«ã™ã‚‹ã€‚

#### è²¬å‹™

- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥:** JSON å½¢å¼, 24æ™‚é–“ TTL (`data/cache/`)
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™:** API å‘¼ã³å‡ºã—é–“ã« 1ç§’ãƒ‡ã‚£ãƒ¬ã‚¤
- **ç•°å¸¸å€¤ã‚µãƒ‹ã‚¿ã‚¤ã‚º:**
  - é…å½“åˆ©å›ã‚Š > 15% â†’ é™¤å¤–
  - PBR < 0.1 â†’ é™¤å¤–
  - é…å½“åˆ©å›ã‚ŠãŒãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆå€¤ã§è¿”ã‚‹å ´åˆã®æ­£è¦åŒ–
- **ETF åˆ¤å®š:** `quoteType`, å£²ä¸Šå±¥æ­´ã® truthiness ãƒã‚§ãƒƒã‚¯
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°:** ãƒ†ã‚£ãƒƒã‚«ãƒ¼å–å¾—å¤±æ•—æ™‚ã®ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

#### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰

```python
class YahooClient:
    def get_ticker_info(self, ticker: str) -> dict
    def get_financials(self, ticker: str) -> dict
    def get_history(self, ticker: str, period: str = "2y") -> pd.DataFrame
    def get_analyst_data(self, ticker: str) -> dict
    def get_news(self, ticker: str) -> list[dict]
    def screen_equities(self, region: str, filters: dict) -> list[dict]
    def search_tickers(self, query: str, max_results: int = 3, prefer_jpx: bool = False) -> list[str]
    def get_localized_names(self, tickers: list[str], lang: str = "ja-JP", region: str = "JP") -> dict[str, str]
    def is_etf(self, ticker: str) -> bool
```

### llm_client.py â€” ãƒ­ãƒ¼ã‚«ãƒ« LLM ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

#### Ollama é€£æº

```python
class LLMClient:
    def __init__(self, model: str = "qwen3:8b", base_url: str = "http://localhost:11434"):
        ...

    def generate(self, prompt: str, system: str = None, temperature: float = 0.3) -> str:
        """å˜ç™ºãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ"""

    def chat(self, messages: list[dict], system: str = None, temperature: float = 0.3) -> str:
        """ãƒãƒ£ãƒƒãƒˆå½¢å¼ (å¯¾è©±å±¥æ­´ã‚ã‚Š)"""

    def analyze_stock(self, stock_data: dict) -> str:
        """éŠ˜æŸ„ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šè‡ªç„¶è¨€èªãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ"""

    def summarize_portfolio(self, portfolio_data: dict) -> str:
        """ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªå…¨ä½“ã®è©•ä¾¡ã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆ"""
```

#### æ¨å¥¨ãƒ¢ãƒ‡ãƒ«

RTX PRO 5000 (48GB VRAM) ç’°å¢ƒ:

| ãƒ¢ãƒ‡ãƒ« | ã‚µã‚¤ã‚º | ç”¨é€” | å‚™è€ƒ |
|--------|------|------|------|
| qwen3:8b | ~6GB | æ—¥æœ¬èªãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ»å¯¾è©± | **ç¾åœ¨ä½¿ç”¨ä¸­** |
| qwen3:14b | ~10GB | ã‚ˆã‚Šé«˜å“è³ªãªåˆ†æ | VRAM ã«ä½™è£•ãŒã‚ã‚Œã° |
| qwen3:32b | ~22GB | æœ€é«˜å“è³ª | ã•ã‚‰ã«ä½™è£•ãŒã‚ã‚Œã° |
| gemma3:27b | ~18GB | ä»£æ›¿é¸æŠè‚¢ | å¤šè¨€èªå¯¾å¿œ |

> **é‡è¦:** `app.py` ã® `LLMClient(model="qwen3:8b")` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«åã¨ä¸€è‡´ã•ã›ã‚‹ã“ã¨ã€‚
> ãƒ¢ãƒ‡ãƒ«åä¸ä¸€è‡´ã¯ã€ŒLLM ã‹ã‚‰ã®å¿œç­”ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€ã‚¨ãƒ©ãƒ¼ã®åŸå› ã«ãªã‚‹ã€‚
> ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã¯ `ollama list` ã§ç¢ºèªã§ãã‚‹ã€‚

#### Graceful Degradation

- Ollama ãŒèµ·å‹•ã—ã¦ã„ãªã„å ´åˆã€LLM æ©Ÿèƒ½ã‚’ã‚¹ã‚­ãƒƒãƒ—
- ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ç­‰ã®å®šé‡éƒ¨åˆ†ã¯ LLM ç„¡ã—ã§å®Œå…¨å‹•ä½œ
- UI ä¸Šã§ã€ŒLLM æœªæ¥ç¶šã€ã‚’è¡¨ç¤ºã—ã€æ¥ç¶šæ–¹æ³•ã‚’æ¡ˆå†…

### cache_manager.py â€” ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†

```python
class CacheManager:
    def __init__(self, cache_dir: str = "data/cache", ttl_hours: int = 24):
        ...

    def get(self, key: str) -> Optional[dict]
    def set(self, key: str, data: dict) -> None
    def invalidate(self, key: str) -> None
    def cleanup_expired(self) -> int  # æœŸé™åˆ‡ã‚Œå‰Šé™¤, å‰Šé™¤æ•°ã‚’è¿”ã™
```

---

## UI å±¤ (Gradio) è¨­è¨ˆ

### ã‚¿ãƒ–æ§‹æˆ

```python
import gradio as gr

with gr.Blocks(title="Stock Review", theme=gr.themes.Soft()) as app:
    gr.Markdown("# ğŸ“Š Stock Review")

    with gr.Tabs():
        with gr.Tab("ğŸ” ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°"):
            # screening_tab.py
        with gr.Tab("ğŸ“‹ éŠ˜æŸ„ãƒ¬ãƒãƒ¼ãƒˆ"):
            # report_tab.py
        with gr.Tab("ğŸ’¼ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª"):
            # portfolio_tab.py
        with gr.Tab("âš¡ ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ"):
            # stress_test_tab.py
        with gr.Tab("ğŸ’¬ AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ"):
            # chat_tab.py
```

### å„ã‚¿ãƒ–ã® UI æ¦‚è¦

#### ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã‚¿ãƒ–

```
â”Œâ”€ è¨­å®šãƒ‘ãƒãƒ« (å·¦) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€ çµæœãƒ‘ãƒãƒ« (å³) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åœ°åŸŸ: [Japan â–¼]            â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ ãƒ—ãƒªã‚»ãƒƒãƒˆ: â—‹value â—‹high-  â”‚  â”‚ â”‚  çµæœãƒ†ãƒ¼ãƒ–ãƒ«              â”‚  â”‚
â”‚   dividend â—‹growth-value   â”‚  â”‚ â”‚  (ã‚¹ã‚³ã‚¢, PER, PBR, ...)  â”‚  â”‚
â”‚ ã‚»ã‚¯ã‚¿ãƒ¼: [å…¨ã‚»ã‚¯ã‚¿ãƒ¼ â–¼]    â”‚  â”‚ â”‚                           â”‚  â”‚
â”‚ [ğŸ” ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°å®Ÿè¡Œ]     â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚  â”‚ [ğŸ“‹ é¸æŠéŠ˜æŸ„ã®ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã‚¿ãƒ–

```
â”Œâ”€ æ“ä½œãƒ‘ãƒãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å£²è²·è¨˜éŒ²] [ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ] [æ§‹é€ åˆ†æ] [ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯] [åˆ©å›ã‚Š] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢                       â”‚
â”‚  (é¸æŠã—ãŸæ“ä½œã«å¿œã˜ã¦å‹•çš„ã«è¡¨ç¤º)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã‚¿ãƒ–

```
â”Œâ”€ å…¥åŠ› â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ†ã‚£ãƒƒã‚«ãƒ¼: [7203.T,AAPL]   â”‚
â”‚ ã‚·ãƒŠãƒªã‚ª: [ãƒˆãƒªãƒ—ãƒ«å®‰ â–¼]     â”‚
â”‚ [âš¡ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ]              â”‚
â”œâ”€ çµæœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é›†ä¸­åº¦ (HHI): 0.35          â”‚
â”‚ VaR (95%): -12.5%           â”‚
â”‚ ã‚·ãƒŠãƒªã‚ªã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ: ...      â”‚
â”‚ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ...          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä»•æ§˜

### config/presets.yaml

```yaml
value:
  description: "ãƒãƒªãƒ¥ãƒ¼ (æ¨™æº–)"
  filters:
    per_max: 15
    pbr_max: 1.5
    dividend_yield_min: 2.0
    market_cap_min: 10000000000  # 100å„„å††
  score_weights:
    per: 25
    pbr: 25
    dividend_yield: 20
    roe: 15
    revenue_growth: 15

high-dividend:
  description: "é«˜é…å½“"
  filters:
    dividend_yield_min: 3.5
    per_max: 20
    payout_ratio_max: 80
  score_weights:
    dividend_yield: 40
    per: 20
    pbr: 15
    roe: 15
    revenue_growth: 10

# ... ä»–ã®ãƒ—ãƒªã‚»ãƒƒãƒˆ
```

### config/exchanges.yaml

```yaml
japan:
  name: "æ—¥æœ¬"
  exchanges: ["JPX"]
  currency: "JPY"
  equity_query_region: "jp"

us:
  name: "ç±³å›½"
  exchanges: ["NYSE", "NASDAQ"]
  currency: "USD"
  equity_query_region: "us"

asean:
  name: "ASEAN"
  exchanges: ["SGX", "SET", "BURSA"]
  currency: null  # è¤‡æ•°é€šè²¨
  equity_query_region: ["sg", "th", "my"]

# ... ä»–ã®åœ°åŸŸ
```

### config/scenarios.yaml

```yaml
triple_decline:
  name: "ãƒˆãƒªãƒ—ãƒ«å®‰"
  description: "æ ªå®‰ãƒ»å††å®‰ãƒ»å‚µåˆ¸å®‰ã®åŒæ™‚ç™ºç”Ÿ"
  shocks:
    equity: -0.20
    bond: -0.10
    fx_jpy: -0.15
  etf_overrides:
    gold: 0.10      # é‡‘ã¯ãƒ˜ãƒƒã‚¸
    long_bond: -0.15

tech_crash:
  name: "ãƒ†ãƒƒã‚¯æš´è½"
  description: "ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã‚»ã‚¯ã‚¿ãƒ¼æ€¥è½"
  shocks:
    technology: -0.35
    other_equity: -0.10
  sector_multipliers:
    Technology: 2.0
    Communication Services: 1.5

# ... ä»–ã®ã‚·ãƒŠãƒªã‚ª
```

---

## ãƒ­ãƒ¼ã‚«ãƒ« LLM çµ±åˆæ–¹é‡

### è¨­è¨ˆåŸå‰‡: å®šé‡ã¨å®šæ€§ã®åˆ†é›¢

```
å®šé‡åˆ†æ (Python)          å®šæ€§åˆ†æ (ãƒ­ãƒ¼ã‚«ãƒ« LLM)
â”œâ”€ ãƒãƒªãƒ¥ãƒ¼ã‚¹ã‚³ã‚¢è¨ˆç®—       â”œâ”€ æŠ•è³‡åˆ¤æ–­ã‚µãƒãƒªãƒ¼ç”Ÿæˆ
â”œâ”€ å¤‰åŒ–ã‚¹ã‚³ã‚¢è¨ˆç®—          â”œâ”€ ãƒªã‚¹ã‚¯è¦å› ã®è‡ªç„¶è¨€èªè§£èª¬
â”œâ”€ VaR è¨ˆç®—               â”œâ”€ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®è£œè¶³èª¬æ˜
â”œâ”€ HHI é›†ä¸­åº¦             â”œâ”€ å¯¾è©±çš„è³ªå•ã¸ã®å›ç­”
â”œâ”€ ç›¸é–¢åˆ†æ               â””â”€ éŠ˜æŸ„æ¯”è¼ƒã®å®šæ€§è©•ä¾¡
â””â”€ ã‚·ãƒŠãƒªã‚ªã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ
```

**åŸå‰‡:** è¨ˆç®—çµæœã¯ Python ã§ç¢ºå®šã•ã›ã€LLM ã¯è§£é‡ˆãƒ»èª¬æ˜ã®ã¿ã‚’æ‹…å½“ã€‚LLM ãŒè¨ˆç®—çµæœã‚’è¦†ã™ã“ã¨ã¯ãªã„ã€‚

### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ

#### éŠ˜æŸ„ãƒ¬ãƒãƒ¼ãƒˆç”¨ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹

```
ã‚ãªãŸã¯æ ªå¼æŠ•è³‡ã®ã‚¢ãƒŠãƒªã‚¹ãƒˆã§ã™ã€‚
æä¾›ã•ã‚ŒãŸè²¡å‹™ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã€æŠ•è³‡åˆ¤æ–­ã«å½¹ç«‹ã¤ã‚µãƒãƒªãƒ¼ã‚’æ—¥æœ¬èªã§ä½œæˆã—ã¦ãã ã•ã„ã€‚

ãƒ«ãƒ¼ãƒ«:
- æä¾›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã¿ã«åŸºã¥ã„ã¦åˆ†æã™ã‚‹ã“ã¨
- æŠ•è³‡åŠ©è¨€ã§ã¯ãªãã€æƒ…å ±æä¾›ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¤ºã™ã‚‹ã“ã¨
- ãƒã‚¸ãƒ†ã‚£ãƒ–/ãƒã‚¬ãƒ†ã‚£ãƒ–ä¸¡é¢ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆãè¨˜è¿°ã™ã‚‹ã“ã¨
- å°‚é–€ç”¨èªã‚’ä½¿ã†å ´åˆã¯ç°¡æ½”ãªèª¬æ˜ã‚’æ·»ãˆã‚‹ã“ã¨
```

### Ollama ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

```bash
# Ollama ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å ´åˆ)
curl -fsSL https://ollama.com/install.sh | sh

# ãƒ¢ãƒ‡ãƒ«ä¿å­˜å…ˆã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã® models/ ãƒ•ã‚©ãƒ«ãƒ€ã«è¨­å®š
export OLLAMA_MODELS=/path/to/stock-advisor/models
# Windows ã®å ´åˆ:
# $env:OLLAMA_MODELS = "D:\GitHub\stock-advisor\models"

# æ¨å¥¨ãƒ¢ãƒ‡ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ (models/ ãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã•ã‚Œã‚‹)
ollama pull qwen3:8b   # ç¾åœ¨ä½¿ç”¨ä¸­
# ollama pull qwen3:14b  # ã‚ˆã‚Šé«˜å“è³ª

# ã‚µãƒ¼ãƒãƒ¼èµ·å‹• (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: http://localhost:11434)
OLLAMA_MODELS=/path/to/stock-advisor/models ollama serve
# Windows ã®å ´åˆ:
# $env:OLLAMA_MODELS = "D:\GitHub\stock-advisor\models"; ollama serve
```

> **æ³¨æ„:** `models/` ãƒ•ã‚©ãƒ«ãƒ€ã¯ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã„ãŸã‚ (10ã€œ48GB)ã€`.gitignore` ã«è¿½åŠ ã— git ç®¡ç†å¤–ã«ã™ã‚‹ã“ã¨ã€‚

---

## ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### requirements.txt

```
# Data
yfinance>=0.2.40
numpy>=1.24.0
pandas>=2.0.0

# UI
gradio>=5.0.0

# Config
pyyaml>=6.0

# LLM
requests>=2.31.0   # Ollama API å‘¼ã³å‡ºã—ç”¨

# Testing
pytest>=7.0.0
pytest-mock>=3.10.0
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¾å­˜

```
# é«˜åº¦ãªãƒãƒ£ãƒ¼ãƒˆ (å°†æ¥æ‹¡å¼µ)
plotly>=5.0.0
matplotlib>=3.7.0
```

---

## é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

- Python 3.10+
- å‹ãƒ’ãƒ³ãƒˆå¿…é ˆ (é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£)
- docstring: Google ã‚¹ã‚¿ã‚¤ãƒ«
- ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿: ruff
- ãƒ†ã‚¹ãƒˆ: pytest, å¤–éƒ¨ API ã¯ãƒ¢ãƒƒã‚¯

### ãƒ†ã‚¹ãƒˆæ–¹é‡

- Core å±¤: å…¨é–¢æ•°ã«å¯¾ã™ã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ (ãƒ¢ãƒƒã‚¯ä½¿ç”¨)
- Data å±¤: ãƒ¢ãƒƒã‚¯ãƒ™ãƒ¼ã‚¹ (å®Ÿéš›ã® API ã¯å©ã‹ãªã„)
- UI å±¤: æ‰‹å‹•ãƒ†ã‚¹ãƒˆä¸­å¿ƒ (Gradio ã®ãƒ†ã‚¹ãƒˆã¯é™å®šçš„)
- ç›®æ¨™: ä¿®æ­£ã®ãŸã³ã«å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ (20ç§’ä»¥å†…)

### å®Ÿè£…é †åº (æ¨å¥¨)

```
Phase 1: åŸºç›¤ + ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°
  1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ãƒ»è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
  2. yahoo_client.py (ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥)
  3. indicators.py (ãƒãƒªãƒ¥ãƒ¼ã‚¹ã‚³ã‚¢)
  4. screener.py (QueryScreener ã®ã¿)
  5. screening_tab.py (Gradio UI)
  â†’ ã“ã“ã§å‹•ä½œç¢ºèª

Phase 2: ãƒ¬ãƒãƒ¼ãƒˆ + LLM
  6. report_generator.py
  7. llm_client.py (Ollama é€£æº)
  8. report_tab.py
  â†’ LLM çµ±åˆãƒ†ã‚¹ãƒˆ

Phase 3: ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª
  9. portfolio_manager.py
  10. health_check.py
  11. return_estimate.py
  12. portfolio_tab.py

Phase 4: ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ
  13. concentration.py, correlation.py
  14. shock_sensitivity.py, scenario_analysis.py
  15. recommender.py
  16. stress_test_tab.py

Phase 5: å¯¾è©±ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
  17. chat_tab.py (ãƒãƒ£ãƒƒãƒˆ UI + LLM çµ±åˆ)
  18. å…¨æ©Ÿèƒ½ã¨ã®é€£æº

Phase 6: ãƒ†ã‚¹ãƒˆãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿
  19. ãƒ†ã‚¹ãƒˆæ‹¡å……
  20. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
  21. UI ãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—
```

---

## æ—¢çŸ¥ã®æ³¨æ„ç‚¹ (å…ƒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã®çŸ¥è¦‹)

### yfinance ã®ãƒ‡ãƒ¼ã‚¿ã®ç™–

1. **ETF ã®å£²ä¸Šå±¥æ­´ãŒç©ºãƒªã‚¹ãƒˆ:** `is not None` ã§ã¯ãªã `bool()` ãƒã‚§ãƒƒã‚¯ã‚’ä½¿ã†
2. **é…å½“åˆ©å›ã‚ŠãŒãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆå€¤ã§è¿”ã‚‹å ´åˆãŒã‚ã‚‹:** æ­£è¦åŒ–å‡¦ç†ãŒå¿…è¦
3. **ã‚¢ãƒŠãƒªã‚¹ãƒˆå°‘æ•°æ™‚:** ç›®æ¨™æ ªä¾¡ High/Mean/Low ãŒåŒå€¤ â†’ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰è‡ªå‹•æ‹¡å¼µ
4. **ETF ãƒªã‚¿ãƒ¼ãƒ³ã®å¹´ç‡æ›ç®—:** æœˆæ¬¡ãƒªã‚¿ãƒ¼ãƒ³Ã—12 (å˜åˆ©) ã§ã¯ãªã CAGR (è¤‡åˆ©å¹´ç‡) ã‚’ä½¿ã†
5. **EquityQuery ã®åœ°åŸŸã‚³ãƒ¼ãƒ‰:** yfinance å´ã®ä»•æ§˜å¤‰æ›´ã«æ³¨æ„

### Yahoo Finance éŠ˜æŸ„æ¤œç´¢ API ã®åˆ¶ç´„ (é‡è¦)

`yf.Search` ãŠã‚ˆã³ `/v1/finance/search` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯**æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ãªã„** (400 ã‚¨ãƒ©ãƒ¼)ã€‚

```
yf.Search("ä¸‰è±é‡å·¥")   â†’ çµæœãªã— (ç©º)
yf.Search("Mitsubishi Heavy Industries")  â†’ 7011.T ã‚’å«ã‚€çµæœãŒè¿”ã‚‹
```

**å¯¾ç­– (report_tab.py / chat_tab.py ã«å®Ÿè£…æ¸ˆã¿):**
1. å…¥åŠ›ã«æ—¥æœ¬èªæ–‡å­—ãŒå«ã¾ã‚Œã‚‹å ´åˆã€LLM ã«è‹±èªç¤¾åã¸ç¿»è¨³ã•ã›ã‚‹
2. è‹±èªç¤¾åã§æ¤œç´¢ã—ã€`prefer_jpx=True` ã§ `.T` ãƒ†ã‚£ãƒƒã‚«ãƒ¼ã‚’å„ªå…ˆå–å¾—
3. LLM æœªæ¥ç¶šæ™‚ã¯ãƒ†ã‚£ãƒƒã‚«ãƒ¼ç›´æ¥å…¥åŠ›ã‚’ä¿ƒã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

```python
# LLM ã«ã‚ˆã‚‹æ—¥æœ¬èªâ†’è‹±èªå¤‰æ› (report_tab.py)
english_name = _llm_translate_to_english("ä¸‰è±é‡å·¥", llm_client)
# â†’ "Mitsubishi Heavy Industries"
candidates = yahoo_client.search_tickers(english_name, prefer_jpx=True)
# â†’ ["7011.T", ...]
```

### Graceful Degradation ãƒ‘ã‚¿ãƒ¼ãƒ³

- Ollama æœªèµ·å‹• â†’ LLM æ©Ÿèƒ½ã‚¹ã‚­ãƒƒãƒ—ã€ãƒ‡ãƒ¼ã‚¿åˆ†æã®ã¿ã§å‹•ä½œ
- yfinance API ã‚¨ãƒ©ãƒ¼ â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- ã‚¢ãƒŠãƒªã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æ¬ æ â†’ éå»ãƒªã‚¿ãƒ¼ãƒ³ãƒ™ãƒ¼ã‚¹ã«åˆ‡ã‚Šæ›¿ãˆ
- LLM ãƒ¢ãƒ‡ãƒ«åä¸ä¸€è‡´ â†’ `chat()` / `generate()` ãŒç©ºæ–‡å­—ã‚’è¿”ã™ â†’ `ollama list` ã§ãƒ¢ãƒ‡ãƒ«åç¢ºèª

---

## å®Ÿè£…æ¸ˆã¿çŠ¶æ³ (Phase 1ã€œ5 å®Œäº† / Phase 6 æ®‹)

### å®Œäº†ãƒ•ã‚¡ã‚¤ãƒ«

```
app.py                          # Gradio ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ (LLMClient model="qwen3:8b")
start.bat                       # Windows èµ·å‹•ç”¨ãƒãƒƒãƒ (Python ãƒ•ãƒ«ãƒ‘ã‚¹æŒ‡å®š)
config/presets.yaml             # 7 ãƒ—ãƒªã‚»ãƒƒãƒˆå®šç¾©
config/exchanges.yaml           # 10 åœ°åŸŸå®šç¾©
config/scenarios.yaml           # 8 ã‚·ãƒŠãƒªã‚ªå®šç¾©

# Data å±¤
src/data/cache_manager.py       # JSON ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (24h TTL)
src/data/yahoo_client.py        # yfinance 1.x ãƒ©ãƒƒãƒ‘ãƒ¼ + search_tickers (prefer_jpxå¯¾å¿œ)
src/data/llm_client.py          # Ollama ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (model="qwen3:8b")

# Core å±¤
src/core/indicators.py          # ãƒãƒªãƒ¥ãƒ¼ã‚¹ã‚³ã‚¢è¨ˆç®—
src/core/screener.py            # QueryScreener / ValueScreener / PullbackScreener / AlphaScreener
src/core/alpha.py               # å¤‰åŒ–ã‚¹ã‚³ã‚¢è¨ˆç®—
src/core/technicals.py          # ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™ãƒ»æŠ¼ã—ç›®åˆ¤å®š
src/core/health_check.py        # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ (3æ®µéšã‚¢ãƒ©ãƒ¼ãƒˆ)
src/core/return_estimate.py     # æ¨å®šåˆ©å›ã‚Š (3ã‚·ãƒŠãƒªã‚ª)
src/core/concentration.py       # HHI é›†ä¸­åº¦åˆ†æ
src/core/correlation.py         # ç›¸é–¢åˆ†æãƒ»ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼åˆ†è§£ãƒ»VaR
src/core/shock_sensitivity.py   # ã‚·ãƒ§ãƒƒã‚¯æ„Ÿå¿œåº¦
src/core/scenario_analysis.py   # ã‚·ãƒŠãƒªã‚ªåˆ†æ (8ã‚·ãƒŠãƒªã‚ª)
src/core/recommender.py         # æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ
src/core/portfolio_manager.py   # ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç®¡ç† (å£²è²·è¨˜éŒ²ãƒ»æç›Š)
src/core/report_generator.py    # å€‹åˆ¥éŠ˜æŸ„ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ (LLMåˆ†æä»˜ã)

# UI å±¤
src/ui/components.py            # å…±é€š UI
src/ui/screening_tab.py         # ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã‚¿ãƒ–
src/ui/report_tab.py            # éŠ˜æŸ„ãƒ¬ãƒãƒ¼ãƒˆã‚¿ãƒ– (ä¼šç¤¾åâ†’ãƒ†ã‚£ãƒƒã‚«ãƒ¼è§£æ±ºãƒ»LLMç¿»è¨³å¯¾å¿œ)
src/ui/portfolio_tab.py         # ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç®¡ç†ã‚¿ãƒ–
src/ui/stress_test_tab.py       # ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã‚¿ãƒ–
src/ui/chat_tab.py              # AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚¿ãƒ– (LLMçµ±åˆãƒ»ä¼šç¤¾åæ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯)

# Utils
src/utils/formatter.py          # ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿
src/utils/validators.py         # ãƒãƒªãƒ‡ãƒ¼ã‚¿
tests/conftest.py               # pytest ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
```

### æ®‹ä½œæ¥­ (Phase 6)

- ãƒ†ã‚¹ãƒˆæ‹¡å…… (Core å±¤ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ)
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- UI ãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—

### èµ·å‹•æ–¹æ³•

```bat
:: Windows
start.bat

:: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³
set PYTHONIOENCODING=utf-8
D:\miniconda3\conda_envs\main\python.exe app.py
```

---

## é–‹ç™ºç’°å¢ƒ (å®Ÿæ©Ÿæƒ…å ±)

| é …ç›® | å€¤ |
|------|-----|
| OS | Windows 11 Pro |
| conda ç’°å¢ƒ | `main` |
| Python ãƒ‘ã‚¹ | `D:\miniconda3\conda_envs\main\python.exe` |
| ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ | `PYTHONIOENCODING=utf-8 /d/miniconda3/conda_envs/main/python.exe script.py` |
| yfinance | 1.2.0 |
| Gradio | 6.x |
| GPU | RTX PRO 5000 (48GB VRAM) |

---

## æ—¢çŸ¥ã®æ³¨æ„ç‚¹ â€” yfinance 1.x ã¸ã®ç§»è¡Œ (é‡è¦)

yfinance **1.x** ã¯ 0.2.x ã‹ã‚‰ API ãŒå¤§å¹…å¤‰æ›´ã€‚ä»¥ä¸‹ã‚’å¿…ãšå®ˆã‚‹ã“ã¨ã€‚

### Screener API

```python
# NG (0.2.x ã‚¹ã‚¿ã‚¤ãƒ« â€” å»ƒæ­¢)
from yfinance import Screener
s = Screener()
s.set_body({...})

# OK (1.x ã‚¹ã‚¿ã‚¤ãƒ«)
import yfinance as yf
from yfinance import EquityQuery
resp = yf.screen(query, size=100, sortField="intradaymarketcap", sortAsc=False)
quotes = resp.get("quotes", [])
```

### EquityQuery ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å

| æ¡ä»¶ | æ—§ (0.2.x) | æ–° (1.x) |
|------|-----------|---------|
| PER ãƒ•ã‚£ãƒ«ã‚¿ | `peratio.lasttwelvemonths` (lt) | `peratio.lasttwelvemonths` (btwn [0, max]) |
| PBR ãƒ•ã‚£ãƒ«ã‚¿ | `pricetobook.lasttwelvemonths` | `pricebookratio.quarterly` |
| é…å½“åˆ©å›ã‚Š | `dividendyield.lasttwelvemonths` (å˜ä½: å°æ•°) | `forward_dividend_yield` (å˜ä½: %) |
| åœ°åŸŸæŒ‡å®š | `set_body` ã® `region` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | `EquityQuery('eq', ['region', 'jp'])` ã‚’ã‚¯ã‚¨ãƒªã«å«ã‚ã‚‹ |
| æ™‚ä¾¡ç·é¡ | `intradaymarketcap` | `intradaymarketcap` (å¤‰æ›´ãªã—) |

> PER ã¯ `btwn [0, max]` ã‚’ä½¿ã†ã“ã¨ã€‚`lt` ã ã¨è² ã® PER (èµ¤å­—ä¼æ¥­) ã‚‚é€šã£ã¦ã—ã¾ã†ã€‚

### æœ‰åŠ¹ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸€è¦§ (EQUITY_SCREENER_FIELDS ã‚ˆã‚Š)

```
price:        intradaymarketcap, intradayprice, percentchange, ...
valuation:    peratio.lasttwelvemonths, pricebookratio.quarterly, pegratio_5y, ...
profitability: returnonequity.lasttwelvemonths, returnonassets.lasttwelvemonths,
               forward_dividend_yield, consecutive_years_of_dividend_growth_count, ...
income_stmt:  totalrevenues1yrgrowth.lasttwelvemonths, epsgrowth.lasttwelvemonths,
              ebitdamargin.lasttwelvemonths, netincomemargin.lasttwelvemonths, ...
eq_fields:    region, exchange, sector, industry, peer_group  (EQ/IS-IN ã®ã¿)
```

### æ—¥æœ¬èªéŠ˜æŸ„åã®å–å¾—

Yahoo Finance ã®é€šå¸¸ API ã¯è‹±èªåã®ã¿ã€‚æ—¥æœ¬èªåã¯å°‚ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§å–å¾—:

```python
# src/data/yahoo_client.py ã® get_localized_names() ã‚’ä½¿ç”¨
# Yahoo Finance v7 API ã« lang=ja-JP ã‚’æŒ‡å®šã™ã‚‹ã¨ longName ãŒæ—¥æœ¬èªã§è¿”ã‚‹
resp = session.get(
    url="https://query2.finance.yahoo.com/v7/finance/quote",
    params={"symbols": "7203.T,9984.T", "lang": "ja-JP", "region": "JP", ...}
)
# result: {"7203.T": "ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š", "9984.T": "ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—"}
```

åœ°åŸŸã”ã¨ã® locale_map (screener.py ã«å®Ÿè£…æ¸ˆã¿):
- `japan` â†’ `lang=ja-JP, region=JP`
- `china` â†’ `lang=zh-TW, region=HK`
- `korea` â†’ `lang=ko-KR, region=KR`

### Gradio 6.x ã®å¤‰æ›´ç‚¹

```python
# NG: theme/css ã¯ Blocks() ã«æ¸¡ã›ãªã„ (Gradio 6 ã§å»ƒæ­¢)
with gr.Blocks(theme=gr.themes.Soft(), css="..."):

# OK: launch() ã«æ¸¡ã™
app.launch(theme=gr.themes.Soft())
```

### Windows ãƒãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã®æ³¨æ„ç‚¹

- `.bat` ãƒ•ã‚¡ã‚¤ãƒ«ã«æ—¥æœ¬èªã‚’å«ã‚ã‚‹ã¨æ–‡å­—åŒ–ã‘ã—ã¦ã‚³ãƒãƒ³ãƒ‰ãŒå£Šã‚Œã‚‹ â†’ **è‹±èªã®ã¿ã§è¨˜è¿°**
- `conda activate` ã¯ãƒãƒƒãƒã‹ã‚‰ç›´æ¥å‘¼ã¹ãªã„ â†’ **Python ã®ãƒ•ãƒ«ãƒ‘ã‚¹ã‚’ç›´æ¥æŒ‡å®š**
- æ–‡å­—åŒ–ã‘é˜²æ­¢: `PYTHONIOENCODING=utf-8` ã‚’ set ã—ã¦ã‹ã‚‰å®Ÿè¡Œ

---

## æ³¨æ„äº‹é …

**æŠ•è³‡ã¯è‡ªå·±è²¬ä»»ã§ã™ã€‚** æœ¬ã‚·ã‚¹ãƒ†ãƒ ã®å‡ºåŠ›ã¯æŠ•è³‡åŠ©è¨€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å®Ÿéš›ã®æŠ•è³‡åˆ¤æ–­ã¯ã€æœ¬ã‚·ã‚¹ãƒ†ãƒ ã®å‡ºåŠ›ã‚’å‚è€ƒæƒ…å ±ã®ä¸€ã¤ã¨ã—ã¦ã€ã”è‡ªèº«ã®åˆ¤æ–­ã§è¡Œã£ã¦ãã ã•ã„ã€‚
